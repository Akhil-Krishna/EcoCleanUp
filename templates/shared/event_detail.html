{% extends "base.html" %}
{% block title %}{{ event[1] }}{% endblock %}

{% block content %}
<div class="mb-3">
    <a href="{{ url_for('browse_events') }}" class="btn btn-eco-outline btn-sm">
        <i class="bi bi-arrow-left me-1"></i>Back to Events
    </a>
</div>

<div class="row g-3">
    <div class="col-lg-8">
        <div class="eco-card overflow-hidden">
            <!-- Header -->
            <div style="background: linear-gradient(135deg, var(--eco-green) 0%, var(--eco-green-light) 100%); color: white; padding: 1.5rem 2rem;">
                <div class="d-flex justify-content-between align-items-start flex-wrap gap-2">
                    <div>
                        <h2 class="fw-700 mb-1">{{ event[1] }}</h2>
                        {% if event[3] %}
                        <span class="badge bg-white text-dark"><i class="bi bi-tag me-1"></i>{{ event[3] }}</span>
                        {% endif %}
                    </div>
                    <span class="badge fs-6 {% if event[11] == 'upcoming' %}bg-primary{% elif event[11] == 'completed' %}bg-success{% elif event[11] == 'cancelled' %}bg-danger{% else %}bg-warning{% endif %}">
                        {{ event[11].title() }}
                    </span>
                </div>
            </div>

            <div class="p-4">
                <!-- Details Grid -->
                <div class="row g-3 mb-4">
                    <div class="col-sm-6">
                        <div class="d-flex align-items-center gap-3 p-3 bg-eco-pale rounded-eco">
                            <i class="bi bi-geo-alt-fill text-eco-green fs-4"></i>
                            <div>
                                <small class="text-muted fw-600 text-uppercase">Location</small>
                                <p class="fw-700 mb-0">{{ event[2] }}</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="d-flex align-items-center gap-3 p-3 bg-eco-pale rounded-eco">
                            <i class="bi bi-calendar3-fill text-eco-green fs-4"></i>
                            <div>
                                <small class="text-muted fw-600 text-uppercase">Date</small>
                                <p class="fw-700 mb-0">{{ event[4].strftime('%A, %d %B %Y') if event[4] else 'TBA' }}</p>
                            </div>
                        </div>
                    </div>
                    {% if event[5] %}
                    <div class="col-sm-6">
                        <div class="d-flex align-items-center gap-3 p-3 bg-eco-pale rounded-eco">
                            <i class="bi bi-clock-fill text-eco-green fs-4"></i>
                            <div>
                                <small class="text-muted fw-600 text-uppercase">Time</small>
                                <p class="fw-700 mb-0">
                                    {{ event[5].strftime('%H:%M') if event[5] else '' }}
                                    {% if event[6] %}â€“ {{ event[6].strftime('%H:%M') if event[6] else '' }}{% endif %}
                                </p>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    {% if event[7] %}
                    <div class="col-sm-6">
                        <div class="d-flex align-items-center gap-3 p-3 bg-eco-pale rounded-eco">
                            <i class="bi bi-hourglass-split text-eco-green fs-4"></i>
                            <div>
                                <small class="text-muted fw-600 text-uppercase">Duration</small>
                                <p class="fw-700 mb-0">{{ event[7] }} hour{{ 's' if event[7] != 1 else '' }}</p>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    <div class="col-sm-6">
                        <div class="d-flex align-items-center gap-3 p-3 bg-eco-pale rounded-eco">
                            <i class="bi bi-person-circle text-eco-green fs-4"></i>
                            <div>
                                <small class="text-muted fw-600 text-uppercase">Event Leader</small>
                                <p class="fw-700 mb-0">{{ event[12] }}</p>
                            </div>
                        </div>
                    </div>
                </div>

                {% if event[8] %}
                <h5 class="fw-700 mb-2" style="color: var(--eco-green);">About This Event</h5>
                <p class="mb-4">{{ event[8] }}</p>
                {% endif %}

                {% if event[9] %}
                <div class="p-3 bg-eco-pale rounded-eco mb-3">
                    <h6 class="fw-700 mb-2"><i class="bi bi-box-seam me-2 text-eco-green"></i>Supplies to Bring</h6>
                    <p class="mb-0">{{ event[9] }}</p>
                </div>
                {% endif %}

                {% if event[10] %}
                <div class="p-3 rounded-eco mb-3" style="background: #fff3cd; border-left: 4px solid #f4a261;">
                    <h6 class="fw-700 mb-2"><i class="bi bi-exclamation-triangle me-2 text-warning"></i>Safety Instructions</h6>
                    <p class="mb-0">{{ event[10] }}</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Sidebar -->
    <div class="col-lg-4">
        {% if session.get('role') == 'volunteer' and event[11] == 'upcoming' %}
        <div class="eco-card p-4 mb-3">
            <h5 class="fw-700 mb-3">Register for This Event</h5>
            {% if is_registered %}
            <div class="alert alert-success mb-3 py-2">
                <i class="bi bi-check-circle me-1"></i> You are registered!
            </div>
            <a href="{{ url_for('participation_history') }}" class="btn btn-eco-outline w-100">
                <i class="bi bi-clock-history me-1"></i>View My Registrations
            </a>
            {% else %}
            <p class="text-muted small mb-3">Join this cleanup event to make a difference in your community.</p>
            <form method="POST" action="{{ url_for('register_for_event', event_id=event[0]) }}">
                <button type="submit" class="btn btn-eco w-100 py-2">
                    <i class="bi bi-plus-circle me-1"></i>Register Now
                </button>
            </form>
            {% endif %}
        </div>
        {% endif %}

        {% if session.get('role') == 'event_leader' and event[13] == session.get('user_id') %}
        <div class="eco-card p-4 mb-3">
            <h5 class="fw-700 mb-3">Manage This Event</h5>
            <div class="d-grid gap-2">
                <a href="{{ url_for('edit_event', event_id=event[0]) }}" class="btn btn-eco-outline">
                    <i class="bi bi-pencil me-1"></i>Edit Event
                </a>
                <a href="{{ url_for('event_volunteers', event_id=event[0]) }}" class="btn btn-eco-outline">
                    <i class="bi bi-people me-1"></i>View Volunteers
                </a>
                <a href="{{ url_for('track_attendance', event_id=event[0]) }}" class="btn btn-eco-outline">
                    <i class="bi bi-clipboard-check me-1"></i>Track Attendance
                </a>
                <a href="{{ url_for('record_outcomes', event_id=event[0]) }}" class="btn btn-eco-outline">
                    <i class="bi bi-bar-chart me-1"></i>Record Outcomes
                </a>
            </div>
        </div>
        {% endif %}

        {% if session.get('role') == 'admin' %}
        <div class="eco-card p-4 mb-3">
            <h5 class="fw-700 mb-3">Admin Actions</h5>
            <div class="d-grid gap-2">
                <a href="{{ url_for('edit_event', event_id=event[0]) }}" class="btn btn-eco-outline">
                    <i class="bi bi-pencil me-1"></i>Edit Event
                </a>
                <a href="{{ url_for('event_volunteers', event_id=event[0]) }}" class="btn btn-eco-outline">
                    <i class="bi bi-people me-1"></i>View Volunteers
                </a>
                {% if event[11] != 'cancelled' %}
                <form method="POST" action="{{ url_for('cancel_event', event_id=event[0]) }}"
                      data-confirm="Are you sure you want to cancel this event?">
                    <button type="submit" class="btn btn-danger w-100">
                        <i class="bi bi-x-circle me-1"></i>Cancel Event
                    </button>
                </form>
                {% endif %}
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
